# Diario di bordo – Progetto “Registro Elettronico Didattix”

**Team:** Alterra Studios  
**Periodo:** Giugno 2025 – Dicembre 2025  
**Project Manager:** Sara Tantucci  

**Ambito del progetto**

Realizzazione di un ambiente dimostrativo per un registro elettronico scolastico (“Registro elettronico Didattix”), basato su:

- una macchina virtuale Ubuntu Server 22.04.5 LTS eseguita su VirtualBox;
- stack Docker per applicazione web, database, monitoring, logging e LLM;
- requisiti aggiuntivi di sicurezza, automazione (backup e report) e API REST di monitoring.

**Responsabilità**

- **Applicazione web / frontend:** Filippo Hinceanu, Daniele Strino  
- **Infrastruttura (VM, sicurezza, Docker, monitoring, LLM, automazioni):** Sara Tantucci, Nicolò Fiorucci  

---

## Giugno 2025 – Analisi e definizione architettura

**Obiettivi**

- Analizzare requisiti funzionali e non funzionali.
- Definire l’architettura complessiva del sistema.

**Attività svolte**

- Raccolta requisiti per il registro elettronico (gestione classi, registro lezioni, consultazione da browser).  
- Analisi dei vincoli del project work: moduli obbligatori (setup, Docker, sicurezza, monitoraggio, automazione) e bonus (API REST, backup automatico, Docker LLM, dashboard).  
- Scelta dell’architettura:
  - unica VM centrale (“`registro`”) per semplificare deployment e dimostrazione;
  - utilizzo estensivo di Docker/Compose per isolare e orchestrare i servizi;
  - integrazione di un LLM locale per scenari di supporto docente.  
- Dimensionamento risorse VM:
  - 16 GB RAM, 8 vCPU, disco VDI dinamico (≥ 40–60 GB) per sostenere web, DB, monitoring, Grafana e LLM.

**Note operative**

L’architettura è stata formalizzata in un diagramma logico (VM → Docker → servizi) e condivisa con il team applicativo per allineare interfacce e punti di integrazione.

---

## Luglio 2025 – Provisioning VM e installazione OS

**Obiettivi**

- Mettere a disposizione una VM Ubuntu stabile, raggiungibile e pronta per la configurazione di sicurezza.

**Attività svolte**

- Creazione VM `registro` in VirtualBox:
  - Tipo `Linux`, versione `Ubuntu (64-bit)`;
  - RAM 16 GB, 8 vCPU, disco VDI dinamico (≥ 40–60 GB);
  - controller grafico VMSVGA con 80 MB di memoria video e accelerazione 3D abilitata.  
- Configurazione rete VirtualBox:
  - scheda in modalità **Scheda con bridge** sulla NIC fisica dell’host;
  - tipo scheda Intel PRO/1000 MT Desktop;
  - modalità promiscua impostata su “Permetti tutto”; cavo virtuale collegato.  
- Installazione Ubuntu Server 22.04.5 LTS:
  - installazione da ISO con partizionamento guidato sull’intero disco;
  - hostname configurato a `registro`;
  - utente amministrativo creato durante il setup;
  - installazione del server OpenSSH.  
- Verifica post‑installazione:
  - controllo di `hostnamectl`, `uname -a`, `lsb_release -a` per confermare versione, kernel e virtualizzazione;
  - verifica rete con `ip a` e fissazione dell’IP di riferimento progetto: **10.10.13.244**.

**Issue / Fix**

- **Issue:** iniziale configurazione NAT che impediva l’accesso diretto da LAN.  
  **Fix:** switch a rete bridged con nuova verifica connettività.  

---

## Agosto 2025 – Sicurezza: gestione identità, SSH e firewall

**Obiettivi**

- Stabilire meccanismi di accesso sicuri e allineati alle best practice.

**Attività svolte**

- Definizione dell’utente operativo principale:
  - account `registro`, utilizzato per manutenzione e gestione applicativa;
  - appartenenza ai gruppi: `adm`, `sudo`, `docker`, `lxd`, `ollama`, `plugdev`.  
- Configurazione accesso SSH:
  - generazione delle chiavi sul client;
  - configurazione del file `~/.ssh/authorized_keys` per l’utente `registro`;
  - verifica e correzione permessi (`700` sulla directory `.ssh`, `600` sui file chiave).  
- Hardening del demone SSH:
  - disabilitazione dell’autenticazione via password;
  - divieto di login diretto dell’utente root;
  - validazione configurazione con `sshd -t` e riavvio del servizio.  
- Configurazione del firewall con UFW:
  - installazione e attivazione (`ufw enable`);
  - regola di allow per OpenSSH;
  - deny esplicito per le porte 23 (Telnet) e 3389 (RDP);
  - verifica dello stato con `ufw status numbered`.

**Issue / Fix**

- **Issue:** blocco temporaneo SSH dopo attivazione UFW (mancava la regola di allow).  
  **Fix:** accesso da console VirtualBox, inserimento regola `ufw allow OpenSSH` e nuova validazione.  
- **Issue:** errori di autenticazione a causa di permessi non corretti nella directory `.ssh`.  
  **Fix:** normalizzazione permessi secondo best practice OpenSSH.

---

## Settembre 2025 – Introduzione di Docker e stack web

**Obiettivi**

- Containerizzare la componente web del registro e il relativo database.

**Attività svolte**

- Installazione Docker Engine e plugin Compose tramite repository ufficiale.  
- Abilitazione del servizio `docker.service` e test con `docker run --rm hello-world`.  
- Aggiunta dell’utente `registro` al gruppo `docker` per l’utilizzo di Docker senza `sudo`.  
- Progettazione del primo `docker-compose.yml`:
  - servizio `db` (MySQL 8) con volume dedicato ai dati;
  - servizio `web` (PHP 8.3 + Apache) esposto sulla porta 8080;
  - servizio `phpmyadmin` esposto sulla porta 8081 per amministrazione DB;
  - rete dedicata per isolare il traffico applicativo.  
- Integrazione dell’applicazione “Registro elettronico Didattix” all’interno del container `web` e test delle principali funzionalità (login, gestione classi, registrazione lezioni).

**Issue / Fix**

- **Issue:** conflitti porta durante i primi deploy.  
  **Fix:** definizione esplicita delle porte 8080 (web) e 8081 (phpMyAdmin) come standard di progetto.  
- **Issue:** phpMyAdmin non raggiungeva MySQL a causa di host errato.  
  **Fix:** aggiornamento delle variabili d’ambiente (`PMA_HOST=db`) e delle dipendenze nel compose.

---

## Ottobre 2025 – Monitoring e logging centralizzato

**Obiettivi**

- Implementare osservabilità di sistema e applicazione (metriche + log).

**Attività svolte**

- Estensione dello stack Docker con:
  - `prometheus` (raccolta metriche),
  - `node-exporter` (metriche della VM),
  - `loki` (data store dei log),
  - `promtail` (agente di shipping log),
  - `grafana` (visualizzazione dashboard).  
- Realizzazione dei file di configurazione:
  - `prometheus.yml`: definizione dei job di scraping (Prometheus, Node Exporter, eventuali target aggiuntivi).  
  - `loki-config.yaml`: gestione ingesters, query e storage su `loki-data` e `loki-data/wal`.  
  - `promtail-config.yaml`: configurazione delle sorgenti di log (`/var/log` e `/home/registro/project-work`).  
- Definizione dei volumi persistenti:
  - `grafana-data` (database SQLite grafana.db),
  - `grafana-provisioning` (datasources e provisioning),
  - `loki-data`, `loki-data/wal` (persistenza dei log).  
- Creazione di dashboard Grafana per:
  - carico di CPU, RAM, storage;
  - stato dei container Docker;
  - analisi log tramite Loki (filtri per servizio).

**Issue / Fix**

- **Issue:** warning DNS nei container con impatti sulle performance dei pull.  
  **Fix:** revisione della configurazione dei resolver del sistema host e del bridge Docker.  
- **Issue:** iniziale raccolta log limitata ai soli log di sistema.  
  **Fix:** aggiornamento di `promtail-config.yaml` includendo la directory del progetto.

---

## Novembre 2025 – LLM, API REST di monitoring e backup automatico

**Obiettivi**

- Coprire i bonus relativi a Docker LLM, API monitoring e backup automatico.

**Attività svolte**

- Stack LLM:
  - container `llm` (image `ollama/ollama:latest`, porta 11434) per servire i modelli LLM;
  - container `webui` (image `ghcr.io/open-webui/open-webui:main`, porta 3500) come interfaccia web per l’LLM;
  - rete dedicata `llm-docker_default` per separare il traffico LLM.  
- API REST di monitoring:
  - sviluppo di un backend Node.js in `/home/registro/project-work/backend/src/server.js`;
  - esposizione dell’API sulla porta 3443;
  - gestione del processo tramite PM2:
    - `pm2 list`, `pm2 info monitoring-api`, `pm2 restart monitoring-api`, `pm2 logs monitoring-api`.  
  - l’API fornisce endpoint di health/status utilizzabili per integrazioni future.  
- Backup automatico:
  - creazione di `/home/registro/project-work/backup/backup.sh` per produrre archivi compressi nelle directory `backup/archive/`;
  - logging dell’esecuzione in `backup/logs/cron.log`;
  - configurazione di un cronjob notturno:

    ```
    0 1 * * * /home/registro/project-work/backup/backup.sh >> /home/registro/project-work/backup/logs/cron.log 2>&1
    ```

**Issue / Fix**

- **Issue:** esistenza parallela di una API Flask sperimentale non integrata.  
  **Fix:** standardizzazione sulla sola API Node.js, eliminando ambiguità di manutenzione.  
- **Issue:** prime esecuzioni del backup non riuscite per permessi e path relativi.  
  **Fix:** aggiunta dei permessi eseguibili, utilizzo di percorsi assoluti e validazione tramite log.

---

## Dicembre 2025 – Monitoraggio periodico, reportistica e consolidamento

**Obiettivi**

- Concludere i moduli di monitoraggio e automazione richiesti.  
- Preparare la documentazione tecnica e di progetto per la consegna.

**Attività svolte**

- Struttura `/opt/project/` per monitoraggio e report:
  - `scripts/monitor.sh`,
  - `scripts/generate-report.sh`,
  - `logs/system.log`,
  - `reports/report-YYYY-MM-DD.txt`.  
- Script `monitor.sh`:
  - raccoglie periodicamente data/ora, load CPU, memoria, spazio disco e stato rete;
  - scrive su `/opt/project/logs/system.log`.  
- Cron di root per il monitoraggio:

*/10 * * * * /opt/project/scripts/monitor.sh

text

- Script `generate-report.sh`:
- crea un report giornaliero a partire dalle ultime 50 righe di `system.log`;
- viene eseguito ogni notte alle 2:00:

0 2 * * * /opt/project/scripts/generate-report.sh

text

- previsto l’invio opzionale via email installando `mailutils` e aggiungendo il comando `mail` all’interno dello script.  
- Validazione del processo di backup notturno e dei cronjob attivi.  
- Redazione del README tecnico dell’infrastruttura e di questo diario, con l’obiettivo di consentire la riproducibilità completa dell’ambiente.

**Issue / Fix**

- **Issue:** log di monitoraggio inizialmente troppo verbosi.  
**Fix:** affinamento dello script `monitor.sh` per mantenere solo i dati realmente utili.  
- **Issue:** alcuni cronjob non venivano eseguiti per permessi mancanti.  
**Fix:** controllo sistematico dei permessi eseguibili e test manuali prima dell’attivazione definitiva.

---

## Sintesi finale

Alla chiusura del periodo progettuale:

- La VM `registro` è configurata secondo buone pratiche (SSH a chiave, UFW attivo, utente dedicato con gruppi ben definiti).  
- Lo stack Docker comprende:
- applicazione web del registro elettronico (PHP/Apache),
- database MySQL e phpMyAdmin,
- monitoring (Prometheus + Node Exporter),
- logging centralizzato (Loki + Promtail),
- dashboard (Grafana),
- componente LLM (Ollama + Open WebUI),
- API REST di monitoring gestita da PM2.  
- Sono presenti automazioni di:
- monitoraggio periodico (script e cron ogni 10 minuti),
- report notturno,
- backup automatico con log dedicati.  
- La documentazione tecnica e questo diario di bordo rendono trasparente il percorso seguito dal team Alterra Studios e consentono a un’azienda di valutare facilmente l’architettura, le scelte implementative e il livello di maturità del progetto.
